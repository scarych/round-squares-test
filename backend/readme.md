# Бэкенд для тестового задания `Round Squares`

Перед запуском надо выполнить `docker compose up -d` для установки `postgres` и `redis`, запускаемые с учетом настроек в `.env`.

Также в `.env` указывается какой логин используется для админа и и какой логин для пользователя с нулевым весом очков (условный Никита). А также настройки времени игрового раунда и кулдауна.

Создание новой игры выполняется без указания параметров, и для нового значения автоматически расчитываются дата начала и окончания игры. Кулдаун используется глобально, хотя его можно поместить в качестве собственного значения в базе, чтобы в случае изменения настроек не возникало конфликтов и перехлёстов.

Для методов генерируется OpenAPI схема, которая используется на фронте через `@tanstack/react-query`.

Тесты не писались.

Для оповещения о новых играх используются сокеты на `socket.io`. Для синхронизации сокетов в режиме кластерного запуска применяется `redis`.

Предусмотрены процедуры graceful-shutdown, чтобы надёжно гасились все процессы при завершении, в том числе в кластерном режиме. Для запуска в кластерном режиме следует указать количество ядер, которые будут зайдествованы.

```sh
# для запуска билда
node dist/main.js 3 # последний аргумент -- количество ядер

# в режиме отладки
px ts-node-dev --respawn --transpile-only --exit-child --tree-kill src/main.ts 3 # последний аргумент -- количество ядер
```
